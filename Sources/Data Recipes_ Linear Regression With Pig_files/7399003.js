document.write('<link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist/embed-2cd369fa1c0830bd3aa06c21d4f14a13e060d2d31bbaae740f4af4602b825bd9.css">')
document.write('<div id=\"gist7399003\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-fit_line-pig\" class=\"file\">\n    \n\n  <div class=\"blob-wrapper data type-piglatin\">\n      <table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-fit_line-pig-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"><\/td>\n        <td id=\"file-fit_line-pig-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">%<\/span><span class=\"pl-smi\">default<\/span> <span class=\"pl-smi\">STEPSIZE<\/span> <span class=\"pl-c1\">0.1<\/span><\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"><\/td>\n        <td id=\"file-fit_line-pig-LC2\" class=\"blob-code blob-code-inner js-file-line\">\n<\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"><\/td>\n        <td id=\"file-fit_line-pig-LC3\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">import<\/span> <span class=\"pl-s\">&#39;macros/linear_model.pig&#39;<\/span>;<\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"><\/td>\n        <td id=\"file-fit_line-pig-LC4\" class=\"blob-code blob-code-inner js-file-line\">\n<\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"><\/td>\n        <td id=\"file-fit_line-pig-LC5\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-smi\">data<\/span> = <span class=\"pl-k\">load<\/span> <span class=\"pl-s\">&#39;$data&#39;<\/span> <span class=\"pl-k\">as<\/span> (<span class=\"pl-smi\">x<\/span><span class=\"pl-k\">:<\/span><span class=\"pl-k\">double<\/span>, <span class=\"pl-smi\">y<\/span><span class=\"pl-k\">:<\/span><span class=\"pl-k\">double<\/span>);<\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"><\/td>\n        <td id=\"file-fit_line-pig-LC6\" class=\"blob-code blob-code-inner js-file-line\">\n<\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"><\/td>\n        <td id=\"file-fit_line-pig-LC7\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">--<\/span><\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"><\/td>\n        <td id=\"file-fit_line-pig-LC8\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">-- The weights are given a schema file by the python driver script<\/span><\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"><\/td>\n        <td id=\"file-fit_line-pig-LC9\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">-- to avoid having to manually specify and arbitrarily large schema<\/span><\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"><\/td>\n        <td id=\"file-fit_line-pig-LC10\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">-- with identical column schemas<\/span><\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"><\/td>\n        <td id=\"file-fit_line-pig-LC11\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">--<\/span><\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"><\/td>\n        <td id=\"file-fit_line-pig-LC12\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-smi\">weights<\/span> = <span class=\"pl-k\">load<\/span> <span class=\"pl-s\">&#39;$input_weights&#39;<\/span> <span class=\"pl-k\">using<\/span> <span class=\"pl-c1\">PigStorage<\/span>(<span class=\"pl-s\">&#39;<span class=\"pl-cce\">\\t<\/span>&#39;<\/span>, <span class=\"pl-s\">&#39;-schema&#39;<\/span>); <\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"><\/td>\n        <td id=\"file-fit_line-pig-LC13\" class=\"blob-code blob-code-inner js-file-line\">\n<\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"><\/td>\n        <td id=\"file-fit_line-pig-LC14\" class=\"blob-code blob-code-inner js-file-line\">\n<\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"><\/td>\n        <td id=\"file-fit_line-pig-LC15\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-smi\">features<\/span> = <span class=\"pl-k\">foreach<\/span> <span class=\"pl-smi\">data<\/span> <span class=\"pl-k\">generate<\/span> <span class=\"pl-smi\">y<\/span> <span class=\"pl-k\">as<\/span> <span class=\"pl-smi\">response<\/span>, <span class=\"pl-c1\">TOTUPLE<\/span>(<span class=\"pl-c1\">1.0<\/span>,<span class=\"pl-smi\">x<\/span>) <span class=\"pl-k\">as<\/span> <span class=\"pl-smi\">vector<\/span>;<\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"><\/td>\n        <td id=\"file-fit_line-pig-LC16\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-smi\">weights<\/span>  = <span class=\"pl-k\">foreach<\/span> <span class=\"pl-smi\">weights<\/span> <span class=\"pl-k\">generate<\/span> <span class=\"pl-c1\">TOTUPLE<\/span>(<span class=\"pl-smi\">w0<\/span>,<span class=\"pl-smi\">w1<\/span>) <span class=\"pl-k\">as<\/span> <span class=\"pl-smi\">weights<\/span>;<\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"><\/td>\n        <td id=\"file-fit_line-pig-LC17\" class=\"blob-code blob-code-inner js-file-line\">\n<\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"><\/td>\n        <td id=\"file-fit_line-pig-LC18\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-smi\">new_weights<\/span> = <span class=\"pl-smi\">sounder_lm_gradient_descent<\/span>(<span class=\"pl-smi\">features<\/span>, <span class=\"pl-smi\">weights<\/span>, $<span class=\"pl-smi\">STEPSIZE<\/span>);<\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"><\/td>\n        <td id=\"file-fit_line-pig-LC19\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-smi\">new_weights<\/span> = <span class=\"pl-k\">foreach<\/span> <span class=\"pl-smi\">new_weights<\/span> <span class=\"pl-k\">generate<\/span> <span class=\"pl-c1\">flatten<\/span>(<span class=\"pl-smi\">$0<\/span>);<\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"><\/td>\n        <td id=\"file-fit_line-pig-LC20\" class=\"blob-code blob-code-inner js-file-line\">\n<\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"><\/td>\n        <td id=\"file-fit_line-pig-LC21\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">--<\/span><\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"><\/td>\n        <td id=\"file-fit_line-pig-LC22\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">-- Store weights in the same way they were came in. The<\/span><\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"><\/td>\n        <td id=\"file-fit_line-pig-LC23\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">-- python driver copies the input weights schema to the output<\/span><\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"><\/td>\n        <td id=\"file-fit_line-pig-LC24\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">-- dir (since it&#39;s the same). The reason for this is to avoid<\/span><\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"><\/td>\n        <td id=\"file-fit_line-pig-LC25\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">-- having to manually specify an as clause, in the project<\/span><\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"><\/td>\n        <td id=\"file-fit_line-pig-LC26\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">-- expression above, with over 100 fields.<\/span><\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"><\/td>\n        <td id=\"file-fit_line-pig-LC27\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\">--<\/span><\/td>\n      <\/tr>\n      <tr>\n        <td id=\"file-fit_line-pig-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"><\/td>\n        <td id=\"file-fit_line-pig-LC28\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">store<\/span> <span class=\"pl-smi\">new_weights<\/span> <span class=\"pl-k\">into<\/span> <span class=\"pl-s\">&#39;$output_weights&#39;<\/span>;<\/td>\n      <\/tr>\n<\/table>\n\n  <\/div>\n\n  <\/div>\n  \n<\/div>\n\n      <\/div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/thedatachef/7399003/raw/57507a3060dd12a1186343336d619c789da15328/fit_line.pig\" style=\"float:right\">view raw<\/a>\n        <a href=\"https://gist.github.com/thedatachef/7399003#file-fit_line-pig\">fit_line.pig<\/a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub<\/a>\n      <\/div>\n    <\/div>\n<\/div>\n')
